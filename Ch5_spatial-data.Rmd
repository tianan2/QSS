---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(ggrepel)
library(maps)
theme_set(theme_light())
options(scipen = 999)
```

```{r}
data("us.cities", package = "maps")
glimpse(us.cities)
  
```

```{r}
usa_map <- map_data("usa")
data("usa", package = "maps")
capitals <- us.cities %>% filter(capital == 2, 
                                 !country.etc %in% c("HI", "AK"))

ggplot() + 
  geom_map(map = usa_map) +
  borders(database = "usa") +
  geom_point(data = capitals, aes(long, lat, size = pop)) + 
  scale_size_area() +
  coord_quickmap() +
  labs(title = "US State Capital")
```
```{r}
ca_cities <- filter(us.cities, country.etc == "CA") %>% 
  arrange(desc(pop)) %>% 
  slice(1:7) %>% 
  mutate(name = str_replace_all(name, "CA", ""))

ggplot() + 
  geom_map(map = usa_map) +
  borders(database = "state", regions = "California") + 
  geom_point(data = ca_cities, aes(long, lat)) + 
  geom_text_repel(data = ca_cities, aes(long, lat, label = name)) + 
  coord_quickmap()

```
```{r}
library(mapdata)
china_map <- map('china') 

names(china_map)
length(china_map$x)
head(cbind(china_map$x, china_map$y))

china_map_data <- map_data("world") %>% filter(region == "China") 

ggplot() +
  borders(database = "world", regions = "China", colour = "black") +
  theme_void()

ggplot(china_map_data, aes(long, lat)) +
  geom_polygon(aes(group = group), fill = NA, color = "black") +
  theme_void()
```

```{r}
library(maptools)


china_map_2 <- readShapePoly("~/Desktop/china-map-data/gadm36_CHN_0.shp")
china_map_3 <- readShapePoly("~/Desktop/china-map-data/gadm36_CHN_1.shp")
china_map_4 <- readShapePoly("~/Desktop/china-map-data/gadm36_CHN_2.shp")
china_map_5 <- readShapePoly("~/Desktop/china-map-data/gadm36_CHN_3.shp")
```

```{r}
library(sf)
library(viridis)
library(viridisLite)

province <- st_read("~/Desktop/china-map-data/gadm36_CHN_1.shp")
city <- st_read("~/Desktop/china-map-data/gadm36_CHN_2.shp")
county <- st_read("~/Desktop/china-map-data/gadm36_CHN_3.shp")

glimpse(province)
plot(province['GID_1'])
```

# Colors in R
```{r}
allcolors <- colors()
head(allcolors)
length(allcolors)

red <- rgb(red = 1, green = 0, blue = 0)
green <- rgb(red = 0, green = 1, blue = 0)
blue <- rgb(red = 0, green = 0, blue = 1)

black <- rgb(red = 0, green = 0, blue = 0)
white <- rgb(red = 1, green = 1, blue = 1)
```
```{r}
ggplot(data = tibble(x = rep(1:4, each = 2), 
       y = x + rep(c(0, 0.2), times = 2), 
       color = rep(c("black", "red"), each = 4), 
       alpha = c(1, 1, .5, .5, 1, 1, .5, .5)),
       aes(x, y, color = color, alpha = alpha)) +
  geom_point(size = 15) + 
  scale_color_identity() + 
  scale_alpha_identity() +
  theme_bw() +
  theme(panel.grid = element_blank())
```
```{r}
data("pres08", package = "qss")
df <- pres08 %>% 
  mutate(state_color = if_else(Obama > McCain, "blue", "red")) %>% 
  mutate(dem = Obama / (Obama + McCain), 
         rep = McCain / (Obama + McCain))

ggplot() + 
  geom_map(map = usa_map) +
  borders(database = "state", regions = "California", fill = "blue") +
  coord_quickmap() +
  theme_void()
  
cal_color <- filter(df, state == "CA") %>% {
    rgb(red = .$rep, green = 0, blue = .$dem)
}

ggplot() +
  borders(database = "state", regions = "California", fill = cal_color) +
  coord_quickmap() +
  theme_void()
```
```{r}
map(database = "state") 
for (i  in 1:nrow(df)) {
    if ( (df$state[i] != "HI") & (df$state[i] != "AK") &
        (df$state[i] != "DC")) {
        map(database = "state", 
            regions = df$state.name[i],
            col = ifelse(df$rep[i] > df$dem[i], "red", "blue"),
            fill = TRUE, 
            add = TRUE)
    }
}
```
```{r}
map(database = "state") 
for (i  in 1:nrow(df)) {
    if ( (df$state[i] != "HI") & (df$state[i] != "AK") &
        (df$state[i] != "DC")) {
        ggplot + borders(database = "state", 
                                    regions = df$state.name[i], 
                                    fill =  ifelse(df$rep[i] > df$dem[i], "red", "blue")) + 
        coord_quickmap() + 
        theme_void()
    }
}
```
```{r}
pres08_states <- map_data("state") %>% 
  left_join(mutate(df, state.name = str_to_lower(state.name)), by = c("region" = "state.name")) %>% 
  filter(!is.na(state_color)) %>% 
  mutate(party = ifelse(dem > rep, "dem", "rep"), 
         color = map2_chr(dem, rep, ~ rgb(blue = .x, red = .y, green = 0)))

ggplot(pres08_states) +
  geom_polygon(aes(long, lat, group = group, fill = party)) +
  coord_quickmap() +
  scale_fill_manual(values = c("dem" = "blue", "rep" = "red")) +
  theme_void()

ggplot(pres08_states) +
  geom_polygon(aes(long, lat, group = group, fill = color)) +
  coord_quickmap() +
  scale_fill_identity() +
  theme_void()

# A different, more clearly distinghishable approach

ggplot(pres08_states) +
  geom_polygon(aes(long, lat, group = group, fill = dem)) +
  coord_quickmap() +
  scale_fill_gradient2(low = "red", high = "blue", midpoint = .5) +
  theme_void()
```


